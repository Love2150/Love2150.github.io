name: CI

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install package (editable) + pytest
        run: |
          python -m pip install --upgrade pip
          # If your package has optional beautify extras:
          # pip install -e .[beautify]
          pip install -e .
          pip install pytest

      - name: Show package info
        run: |
          python -c "import importlib, pkgutil; import eval_unpacker, sys; print('version:', getattr(eval_unpacker, '__version__', 'n/a'))"
          python -c "import shutil; print('eval-unpack on PATH:', shutil.which('eval-unpack'))"

      - name: CLI smoke test (no input expected to succeed)
        run: |
          # Create a tiny packed-like sample to exercise parser
          echo "eval(function(p,a,c,k,e,d){return p}('abc',10,2,'a|b'))" > examples/sample_packed.js
          # Run the CLI. It should print something (no error exit).
          eval-unpack examples/sample_packed.js || (echo 'CLI failed' && exit 1)

      - name: Run pytest (if tests/ exists)
        run: |
          if [ -d tests ]; then
            pytest -q
          else
            echo "No tests/ directory; skipping pytest."
          fi
